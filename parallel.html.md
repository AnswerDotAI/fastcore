# Parallel


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
from fastcore.test import *
from nbdev.showdoc import *
from fastcore.nb_imports import *
```

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L25"
target="_blank" style="float:right; font-size:smaller">source</a>

### threaded

``` python

def threaded(
    process:bool=False
):

```

*Run `f` in a `Thread` (or `Process` if `process=True`), and returns it*

``` python
@threaded
def _1():
    time.sleep(0.05)
    print("second")
    return 5

@threaded
def _2():
    time.sleep(0.01)
    print("first")

a = _1()
_2()
time.sleep(0.1)
```

    first
    second

After the thread is complete, the return value is stored in the `result`
attr.

``` python
a.result
```

    5

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L46"
target="_blank" style="float:right; font-size:smaller">source</a>

### startthread

``` python

def startthread(
    f
):

```

*Like [`threaded`](https://fastcore.fast.ai/parallel.html#threaded), but
start thread immediately*

``` python
@startthread
def _():
    time.sleep(0.05)
    print("second")

@startthread
def _():
    time.sleep(0.01)
    print("first")

time.sleep(0.1)
```

    first
    second

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L51"
target="_blank" style="float:right; font-size:smaller">source</a>

### startproc

``` python

def startproc(
    f
):

```

*Like `threaded(True)`, but start Process immediately*

``` python
@startproc
def _():
    time.sleep(0.05)
    print("second")

@startproc
def _():
    time.sleep(0.01)
    print("first")

time.sleep(0.1)
```

    first
    second

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L67"
target="_blank" style="float:right; font-size:smaller">source</a>

### parallelable

``` python

def parallelable(
    param_name, num_workers, f:NoneType=None
):

```

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L76"
target="_blank" style="float:right; font-size:smaller">source</a>

#### ThreadPoolExecutor

``` python

def ThreadPoolExecutor(
    max_workers:int=4, on_exc:builtin_function_or_method=print, pause:int=0, kwargs:VAR_KEYWORD
):

```

*Same as Python’s ThreadPoolExecutor, except can pass `max_workers==0`
for serial execution*

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L95"
target="_blank" style="float:right; font-size:smaller">source</a>

#### ProcessPoolExecutor

``` python

def ProcessPoolExecutor(
    max_workers:int=4, on_exc:builtin_function_or_method=print, pause:int=0, mp_context:NoneType=None,
    initializer:NoneType=None, initargs:tuple=(), max_tasks_per_child:NoneType=None
):

```

*Same as Python’s ProcessPoolExecutor, except can pass `max_workers==0`
for serial execution*

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L121"
target="_blank" style="float:right; font-size:smaller">source</a>

### parallel

``` python

def parallel(
    f, items, args:VAR_POSITIONAL, n_workers:int=4, total:NoneType=None, progress:NoneType=None, pause:int=0,
    method:NoneType=None, threadpool:bool=False, timeout:NoneType=None, chunksize:int=1, kwargs:VAR_KEYWORD
):

```

*Applies `func` in parallel to `items`, using `n_workers`*

``` python
inp,exp = range(50),range(1,51)

test_eq(parallel(_add_one, inp, n_workers=2), exp)
test_eq(parallel(_add_one, inp, threadpool=True, n_workers=2), exp)
test_eq(parallel(_add_one, inp, n_workers=1, a=2), range(2,52))
test_eq(parallel(_add_one, inp, n_workers=0), exp)
test_eq(parallel(_add_one, inp, n_workers=0, a=2), range(2,52))
```

Use the `pause` parameter to ensure a pause of `pause` seconds between
processes starting. This is in case there are race conditions in
starting some process, or to stagger the time each process starts, for
example when making many requests to a webserver. Set `threadpool=True`
to use
[`ThreadPoolExecutor`](https://fastcore.fast.ai/parallel.html#threadpoolexecutor)
instead of
[`ProcessPoolExecutor`](https://fastcore.fast.ai/parallel.html#processpoolexecutor).

``` python
from datetime import datetime
```

``` python
def print_time(i): 
    time.sleep(random.random()/1000)
    print(i, datetime.now())

parallel(print_time, range(5), n_workers=2, pause=0.25);
```

    0 2026-03-02 01:05:03.452092
    1 2026-03-02 01:05:03.703252
    2 2026-03-02 01:05:03.954401
    3 2026-03-02 01:05:04.205842
    4 2026-03-02 01:05:04.456064

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L145"
target="_blank" style="float:right; font-size:smaller">source</a>

### parallel_async

``` python

async def parallel_async(
    f, items, args:VAR_POSITIONAL, n_workers:int=16, timeout:NoneType=None, chunksize:int=1,
    on_exc:builtin_function_or_method=print, kwargs:VAR_KEYWORD
):

```

*Applies `f` to `items` in parallel using asyncio and a semaphore to
limit concurrency.*

``` python
import asyncio
```

``` python
async def print_time_async(i): 
    wait = random.random()/10
    await asyncio.sleep(wait)
    print(i, datetime.now(), wait)

await parallel_async(print_time_async, range(6), n_workers=3);
```

    2 2026-03-02 01:05:04.619707 0.029843140539236146
    0 2026-03-02 01:05:04.639306 0.048799685254880557
    4 2026-03-02 01:05:04.645109 0.005020813993290385
    3 2026-03-02 01:05:04.681605 0.061389477085912324
    1 2026-03-02 01:05:04.689090 0.09886497116292431
    5 2026-03-02 01:05:04.724735 0.07902482336330133

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L160"
target="_blank" style="float:right; font-size:smaller">source</a>

### bg_task

``` python

def bg_task(
    coro
):

```

*Like `asyncio.create_task` but logs exceptions for fire-and-forget
tasks*

``` python
async def _ok(): return 42
async def _fail(): raise ValueError("this error will be printed")

t1 = bg_task(_ok())
t2 = bg_task(_fail())
await asyncio.sleep(0.01)
test_eq(t1.result(), 42)
```

    Traceback (most recent call last):
      File "/var/folders/51/b2_szf2945n072c0vj2cyty40000gn/T/ipykernel_52556/1179310912.py", line 2, in _fail
        async def _fail(): raise ValueError("this error will be printed")
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ValueError: this error will be printed

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L170"
target="_blank" style="float:right; font-size:smaller">source</a>

### run_procs

``` python

def run_procs(
    f, f_done, args
):

```

*Call `f` for each item in `args` in parallel, yielding `f_done`*

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/parallel.py#L185"
target="_blank" style="float:right; font-size:smaller">source</a>

### parallel_gen

``` python

def parallel_gen(
    cls, items, n_workers:int=4, progress:bool=True, kwargs:VAR_KEYWORD
):

```

*Instantiate `cls` in `n_workers` procs & call each on a subset of
`items` in parallel.*

`cls` is any class with `__call__`. It will be passed `args` and
`kwargs` when initialized. Note that `n_workers` instances of `cls` are
created, one in each process. `items` are then split in `n_workers`
batches and one is sent to each `cls`. The function then returns a
generator of tuples of item indices and results.

``` python
class TestSleepyBatchFunc:
    "For testing parallel processes that run at different speeds"
    def __init__(self): self.a=1
    def __call__(self, batch):
        for k in batch:
            time.sleep(random.random()/10)
            yield k+self.a

x = np.linspace(0,0.99,20)

res = L(parallel_gen(TestSleepyBatchFunc, x, n_workers=2, progress=False))
test_eq(res.sorted().itemgot(1), x+1)
```
